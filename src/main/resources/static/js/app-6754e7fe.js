function send_request(){var e=null;if(window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),null!=e){var t="/Oss/get_code/";return e.open("POST",t,!1),e.send(null),e.responseText}alert("Your browser does not support XMLHTTP.")}function get_signature(file){if(now=timestamp=Date.parse(new Date)/1e3,expire<now+3){var body=send_request(),objTemp=eval("("+body+")"),obj=objTemp;return host=obj.host,policyBase64=obj.policy,accessid=obj.accessid,signature=obj.signature,expire=parseInt(obj.expire),callbackbody=obj.callback,key=obj.dir,!0}return!1}function random_string(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,n="",a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*o));var r=new Date,i=r.getFullYear().toString()+(Number(r.getMonth())+1)+r.getDate().toString()+r.getHours()+r.getMinutes().toString()+r.getSeconds();return i+n}function get_suffix(e){var t=e.lastIndexOf("."),o="";return t!=-1&&(o=e.substring(t)),o}function calculate_object_name(e){var t=get_suffix(e);return g_object_name=key+random_string(4)+t,""}function get_uploaded_object_name(e){return g_object_name}function set_upload_param(e,t,o){if(0==o){o=get_signature(t);for(var n=0;n<t.length;n++)alreadyName[t[n].id]=key+t[n].id+"."+t[n].name.split(".")[1]}var a={key:alreadyName[t.id],policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",callback:callbackbody,signature:signature};e.setOption({url:host,multipart_params:a}),e.start()}function previewImage(e,t){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var o=new mOxie.FileReader;o.onload=function(){t(o.result),o.destroy(),o=null},o.readAsDataURL(e.getSource())}else{var n=new mOxie.Image;n.onload=function(){n.downsize(300,300);var e="image/jpeg"==n.type?n.getAsDataURL("image/jpeg",90):n.getAsDataURL();t&&t(e),n.destroy(),n=null},n.load(e.getSource())}}var xsj=angular.module("xsj",["ngMaterial","ngAnimate","me-lazyload","yaru22.angular-timeago","smoothScroll","angular-plupload","ngMessages"]).run(["$rootScope","$http","$window","$mdToast","$timeout","tool","$sce",function(e,t,o,n,a,r,i){function c(){if(!u){var t=o.scrollY;t>40?document.querySelector("#bs-top").className="swim":document.querySelector("#bs-top").className="",a(t>500?function(){e.scrollup=!0}:function(){e.scrollup=!1})}}function s(o,n){t({method:"GET",url:"/Home/Article/getlist.html",params:{keywords:e.keywords,cid:e.cateModel,p:o}}).success(function(t){e.total=t.count;for(var o=0;o<t.datas.length;o++)t.datas[o].article_title=i.trustAsHtml(t.datas[o].article_title);return e.searchList=t.datas,t.datas&&0!=t.datas.length?(e.nodataIndex=!1,t.datas.length<20&&(e.nomoreIndex=!0),e.searchList.length==t.count&&(e.nomoreIndex=!0),void(n&&n(t))):void(e.nodataIndex=!0)})}function l(t,o){e.countIndex=Math.ceil(t.count/20),e.pageIndex=o,e.prevIndex=1!=e.pageIndex,e.nextIndex=e.countIndex!=e.pageIndex,e.countsIndex=[];for(var n=1;n<=e.countIndex;n++)e.countsIndex.push({mypage:n})}e.enter="enter",e.enterTop="enter-top",a(function(){e.endstart="end"},2e3),e.PAGESIZE=10,"2"!=groupCid&&"4"!=groupCid||(e.PAGESIZE=20),$win=angular.element(o),$win.bind("scroll",c);var u=!1;e.beautyTime=function(e){var e=Number(e+"000"),t=new Date(e),o=t.getMonth()+1;return o<10&&(o="0"+o),t.getFullYear()+"-"+o+"-"+t.getDate()},e.reflash=function(){location.reload()},e.cate=function(e){return e.replace(/\/\d*.html/,"")},e.getTime=function(e){return 1e3*e-100},e.myfavFun=function(e,t){return/xiusheji/.test(e)&&!/@!/.test(e)?t?e+"@!"+t:e+"@!140":e},e.alertTip=function(e,t){n.show(n.simple().textContent(e).position("bottom, right").parent(angular.element(document.getElementById("bs-main"))).hideDelay(1200)).then(function(){t&&t()})},e.menuFun=function(){e.menu=!e.menu},e.loginTip=function(){e.alertTip("请先登录！")},e.searchBtn=function(){e.searching=!e.searching},e.searchFun=function(t,o){if(!o||(console.log(o.which),13==o.which)){if(e.searchnodata=!1,!r.trim(t))return void e.alertTip("请输入关键字");e.keywords=t,s(1,function(e){l(e,1)})}},e.nextPage=function(t,o){t!=o&&("prev"==t?t=e.pageIndex-1:"next"==t&&(t=e.pageIndex+1),e.ListIndex=[],s(t,function(e){l(e,t)}))},e.cates=[{key:0,name:"全部"},{key:59,name:"资讯"},{key:24,name:"大赛"},{key:2,name:"作品"},{key:3,name:"点滴"},{key:4,name:"素材"},{key:1,name:"活动"}],e.cateModel=0,e.changeCate=function(t){e.cateModel=t}}]).factory("tool",["$q","$rootScope","$timeout","$window",function(e,t,o,n){return{getQuery:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null},trim:function(e){return e.replace(/^(\s|\u00A0)+/,"").replace(/(\s|\u00A0)+$/,"")},isToday:function(e){var t=!0,o=new Date(isNaN(e)?e.replace(/-/g,"/").split(" ")[0]:e).getTime(),n=new Date;return n=new Date(n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()),n-o>=864e5&&(t=!1),t},scrollFix:function(e,t,o){function a(){if(!s){var a=n.scrollY,r=a-c;r>=0?i.css({position:"fixed",top:t-(o||0)+"px",left:e.offsetLeft+"px"}):i.css({position:"static",top:"auto",left:"auto"})}}if(!(document.documentElement.clientWidth<1e3)){var r=angular.element(n),e=document.querySelector(e),i=angular.element(e),c=e.offsetTop-t;r.bind("scroll",a);var s=!1;document.documentElement.clientHeight}}}}]).factory("ajaxInjector",["$q","$injector","$rootScope",function(e,t,o){var n={request:function(e){return o.loading=!0,e},response:function(e){return o.loading=!1,e},responseError:function(t){return o.loading=!1,200!==t.status&&alert("服务器错误"),e.reject(t)}};return n}]);xsj.config(["$mdThemingProvider","$httpProvider","$mdDateLocaleProvider","timeAgoSettings","pluploadOptionProvider",function(e,t,o,n,a){e.theme("default").primaryPalette("light-blue").accentPalette("blue"),t.interceptors.push("ajaxInjector"),o.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],o.shortMonths=["一","二","三","四","五","六","七","八","九","十","十一","十二"],o.days=["一","二","三","四","五","六","七"],o.shortDays=["一","二","三","四","五","六","七"],n.allowFuture=!0,n.fullDateAfterSeconds=172800,n.refreshMillis=6e4,a.setOptions({runtimes:"html5, flash, silverlight, html4",flash_swf_url:"lib/plupload/Moxie.swf",silverlight_xap_url:"lib/plupload/Moxie.xap",multi_selection:!0,chunk_size:0,url:"http://oss.aliyuncs.com",resize:{width:1500,quality:95,preserve_headers:!1},filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp,JPG,jpeg,JPEG"}],max_file_size:"6mb",prevent_duplicates:!0}})}]),angular.module("xsj").controller("AboutUs",["$scope","$window",function(e,t){e.mainHeight=angular.element(t)[0].innerHeight+"px"}]),angular.module("xsj").controller("ArtDetail",["$scope","$http","$rootScope","$timeout","tool","$sce",function($scope,$http,$rootScope,$timeout,tool,$sce){function getShowad(e,t,o){$http({method:"GET",url:ajax_get_banner_list,params:{id:e,row:t}}).success(function(e){o(e.datas)})}$scope.topCid=topCid;var typeText={1:"点赞",2:"收藏"};$scope.collectNum=collectNum,$scope.praiseNum=praiseNum,$scope.addEnter=function(e){return $sce.trustAsHtml(e.replace(/\n/g,"</br>"))},"undefined"!=typeof ajax_get_banner_list&&getShowad(4,1,function(e){console.log(e),$scope.forincome=e[0]}),uid&&$http({method:"GET",url:ajax_get_user_article_collect_info,params:{aid:aid,u:uid}}).success(function(e){return"error"==e.status?void $rootScope.alertTip(e.msg):($scope.collect=e.collect,void($scope.praise=e.praise))}),"undefined"!=typeof get_article_recommend_list&&($scope.getRecommend=function(){$http({method:"GET",url:get_article_recommend_list,params:{cid:topCid,limit:3}}).success(function(e){return"error"==e.status?void $rootScope.alertTip(e.msg):void($scope.recommendList=e.datas)})},$scope.getRecommend()),$scope.operat=function(e,t){return uid?void $http({method:"POST",url:t?ajax_cancel_collect:ajax_article_collect,params:{aid:aid,type:e}}).success(function(o){return"error"==o.status?void $rootScope.alertTip(o.msg):($timeout(function(){1==e?(t?$scope.praiseNum--:$scope.praiseNum++,$scope.praise=t?0:1):(t?$scope.collectNum--:$scope.collectNum++,$scope.collect=t?0:1)}),void $rootScope.alertTip(o.msg))}):void $rootScope.alertTip("请先登录！")},angular.element(document.querySelector(".list-right")).length&&tool.scrollFix(".list-right",67,20),$scope.statusTime=function(e,t){var o=new Date,n="已结束";return o<e?n=0==parseInt((e-o)/864e5)?"<b>即将开始</b>":"还有<b>"+parseInt((e-o)/864e5)+"</b>天开始":o<t&&(n=0==parseInt((t-o)/864e5)?"<b>即将结束</b>":"进行中<br/>还有<b>"+parseInt((t-o)/864e5)+"</b>天结束"),$sce.trustAsHtml(n)};var isCanceled=!1,sh;sh=setInterval(function(){document.querySelector(".head-img-w")&&(isCanceled=!0,document.querySelector(".head-img-w").onclick=function(e){e.stopPropagation()}),isCanceled&&clearInterval(sh)},1e3);var isCanceled1=!1,sh1;with(sh1=setInterval(function(){if(document.querySelector(".head-img-gw")){isCanceled1=!0;for(var e=0;e<document.querySelectorAll(".head-img-gw").length;e++)document.querySelectorAll(".head-img-gw")[e].onclick=function(e){e.stopPropagation()},document.querySelectorAll(".user-name-gw")[e].onclick=function(e){e.stopPropagation()}}isCanceled1&&clearInterval(sh1),console.log(2)},1e3),document)(0)[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?v=89860593.js?"]}]),angular.module("xsj").controller("ArtList",["$scope","$location","$http","$rootScope","$timeout","tool","$window",function(e,t,o,n,a,r,i){function c(t){o({method:"GET",url:ajax_get_article_list,params:t}).success(function(o){return e.List=e.List.concat(o.datas),o.datas||(e.List=[]),e.nodata=!e.List.length,o.datas.length<n.PAGESIZE&&(e.nomore=!0),e.page=t.p,e.page%5==0?void(e.nextPageText=!0):void(e.List.length==o.count&&(e.nomore=!0))})}function s(){o({method:"GET",url:ajax_get_article_flag,params:{cid:groupCid,limit:5}}).success(function(t){e.hotList=t.datas})}var l=r.getQuery("page")||0,u=r.getQuery("scid")||"";e.cid=groupCid,2!=groupCid&&3!=groupCid||(e.publicBtn=!0),e.List=[],e.params={p:1+5*l,cid:u||e.cid};var p=!0;e.matchstatus="all",2!=e.cid&&3!=e.cid||(e.matchstatus="c",e.params.flag="c"),c(e.params),e.getCate=function(){e.artCates||o({method:"GET",url:ajax_get_category_son,params:{cid:e.cid}}).success(function(t){e.artCates=[{key:0,name:"全部"}];for(var o=0;o<t.datas.length;o++)e.artCates.push({key:t.datas[o].cid,name:t.datas[o].cname})})},u&&(e.artCateModel=u,e.getCate()),e.changeCate=function(t){p&&(e.getCate(),p=!1),e.params.p=1,"undefined"!=typeof t&&(e.params.cid=0==t?e.cid:t),e.List=[],e.nomore=!1,c(e.params)},e.changeStatus=function(t){return e.params.p=1,"complete"==t?(e.params.proceed=1,delete e.params.notstarted,void(24==e.cid?e.changeCate(61):1==e.cid&&e.changeCate())):"notstarted"==t?(e.params.notstarted=1,delete e.params.proceed,void(24==e.cid?e.changeCate(61):1==e.cid&&e.changeCate())):(delete e.params.proceed,delete e.params.notstarted,"all"==t&&24==e.cid&&e.changeCate(24),"all"==t&&1==e.cid&&e.changeCate(),"all"==t||3!=e.cid&&2!=e.cid?delete e.params.flag:e.params.flag=t,e.List=[],e.nomore=!1,void c(e.params))},e.nextPage=function(){return e.page%5==0?void(location.href="?page="+(Number(l)+1)+"&scid="+e.params.cid):(e.params.p=e.page+1,void c(e.params))},"undefined"!=typeof ajax_get_article_flag&&s(),angular.element(document.querySelector(".list-right")).length&&r.scrollFix(".list-right",67,20)}]),angular.module("xsj").controller("Index",["$rootScope","$scope","$http","$timeout","$mdDialog","$q",function(e,t,o,n,a,r){function i(e){o({method:"GET",url:ajax_get_article_alllist+"?p="+e}).success(function(e){e.datas.length<20&&(t.nomore=!0),t.itemLists=t.itemLists.concat(e.datas),t.itemLists.length==e.count&&(t.nomore=!0)})}function c(e,t,n){o({method:"GET",url:ajax_get_banner_list,params:{id:e,row:t}}).success(function(e){n(e.datas)})}function s(){new Swiper(".swiper-container",{fade:{crossFade:!1},loop:!0,autoplay:5e3,speed:500,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",pagination:".swiper-pagination",paginationElement:"li",paginationClickable:!0})}t.pages=1,t.itemLists=[],t.getMoreLists=function(){t.pages++,i(t.pages)};c(2,6,function(e){t.bannerList=e,n(function(){s()})}),c(1,4,function(e){t.leftList=e.slice(0,5)}),n(function(){t.start=!0,e.showfoot=!0})}]),angular.module("xsj").controller("Publish",["$scope","$timeout","$mdToast","$rootScope","$http","$sce","$window","tool",function(e,t,o,n,a,r,i,c){function s(o,n){"product"==o&&(e.project.intro="简介",t(function(){e.project.intro="",e.artCateModel=31})),e.artCateModel=27,e.img_url="",e.img_urls=[],e.pImgs=[],n||(aid="")}function l(t){e.pImg=t}function u(t){e.img_url=t,l(t)}function p(t,o){e.pImgs.push({img:t,id:o})}function d(t){e.img_urls.push(t)}function m(){if(console.log(e.progress),Object.keys(e.progress).length<e.pImgs.length)return void n.alertTip("请等待图片全部上传完成！");for(var t in e.progress)if(100!=e.progress[t])return void n.alertTip("请等待图片全部上传完成！");if(!e.project.title)return n.alertTip("您还没有填写标题！"),!1;if(!e.artCateModel)return n.alertTip("您还没有选择分类！"),!1;if(!e.img_url)return n.alertTip("您还没有上传封面图片！"),!1;if(!e.project.intro)return n.alertTip("您还没有填写简介！"),!1;if(0!=e.writeType){if(!e.project.auth)return n.alertTip("原作者/网站名 还没填呢！"),!1;if(!e.project.authlink)return n.alertTip("原文链接还没填呢！"),!1}return"article"!=e.tab||""!=e.html||(n.alertTip("您的主要内容还没填呢！"),!1)}function g(t){a({method:"GET",url:ajax_article_edit,params:{aid:t}}).success(function(t){if("error"==t.status)return void n.alertTip(t.msg);if(t.category_cid>=31&&(e.tab="product"),e.project.title=t.article_title,e.artCateModel=t.category_cid,e.writeType=t.article_type,e.img_url=t.pic,e.project.intro=t.description,e.project.auth=t.origin_autor,e.project.authlink=t.origin_url,e.html=t.body,e.artLisModel=t.copyright,window.optionVar.html(t.body),e.img_urls=[],e.pImgs=[],e.project.imgText=[],e.pImgOver=!0,e.pImg=t.pic,t.pics.length)for(var o=0;o<t.pics.length;o++)e.img_urls.push(t.pics[o].big),e.pImgs.push({img:t.pics[o].big+"@!280",id:"no"+o}),e.progress["no"+o]=100,e.project.imgText.push(t.pics[o].pic_description)})}document.title="发布作品",e.writeType=0,e.project={},e.artCateModel=30,e.artLisModel=2,e.img_url="",e.defaultImg=defaultImg,e.tab="product",e.project.imgText=[],e.img_urls=[],e.tabFun=function(t,o){(!e.project.title&&!e.project.intro||confirm("未保存，确定离开？"))&&(e.tab=t,"article"==t&&(document.title="发布文章"),s(t,o))},"article"!=c.getQuery("type")&&"article"!=type||e.tabFun("article","notChange"),e.progress=[],e.fileUpload={url:"http://oss.aliyuncs.com",callback:{postInit:function(){angular.element(document.getElementById("z0")).css("z-index","0")},filesAdded:function(t,o){e.pImgOver=!1,plupload.each(o,function(t){e.progressd=1,previewImage(t,function(e){l(e)})}),set_upload_param(t,o,!1)},beforeUpload:function(e,t){set_upload_param(e,t,!0)},uploadProgress:function(o,n){t(function(){n.percent<100&&(e.progressd=n.percent)})},fileUploaded:function(o,n,a){t(function(){e.progressd=100}),console.log(alreadyName[n.id]),u("https://img.xiusheji.com/"+alreadyName[n.id]),e.pImgOver=!0},error:function(e,t){alert("图片太大，最高6M")}},callbacks:{postInit:this.postInit,filesAdded:function(t,o){return o.length>30?void n.alertTip("请选择少于30张图片！"):(plupload.each(o,function(t){previewImage(t,function(o){p(o,t.id),e.progress[t.id]=1})}),void set_upload_param(t,o,!1))},beforeUpload:function(e,t){set_upload_param(e,t,!0)},uploadProgress:function(o,n){t(function(){n.percent<100&&(e.progress[n.id]=n.percent)})},fileUploaded:function(o,n,a){t(function(){e.progress[n.id]=100}),console.log(alreadyName[n.id]),d("https://img.xiusheji.com/"+alreadyName[n.id])},error:function(e,t){alert("服务器错误或图片太大，最高6M")}}},e.pImgs=[],e.img_urls=[];var f=function(t,o){var n=angular.copy(e.pImgs),a=angular.copy(e.img_urls),r=angular.copy(e.project.imgText);n[t]=n.splice(o,1,n[t])[0],a[t]=a.splice(o,1,a[t])[0],r[t]=r.splice(o,1,r[t])[0],e.pImgs=angular.copy(n),e.img_urls=angular.copy(a),e.project.imgText=angular.copy(r)};e.upRecord=function(e){0!=e&&f(e,e-1)},e.downRecord=function(t){t!=e.img_urls.length-1&&f(t,t+1)},e.imgDel=function(t){e.pImgs.splice(t,1),e.img_urls.splice(t,1)},e.writeTypeChange=function(t){e.writeType=t,2==e.writeType?e.artLisModel=0:e.artLisModel=2},e.previewFun=function(){return e.html=r.trustAsHtml(window.optionVar.html()),e.project.title?""==e.html?void n.alertTip("您的主要内容还没填呢！"):void(n.preview=!0):void n.alertTip("您还没有填写标题！")},n.closePreview=function(){n.preview=!1};var h=!1;e.save=function(t){if(!h){if(h=!0,e.html=window.optionVar.html(),!m())return void(h=!1);var o={article_title:e.project.title,category_cid:e.artCateModel,article_type:e.writeType,pic:e.img_url,description:e.project.intro,body:e.html,copyright:e.artLisModel,draft:1};if(0!=e.writeType&&(o.origin_autor=e.project.auth,o.origin_url=e.project.authlink),"draft"==t&&(o.draft=2),aid&&(o.aid=aid),e.img_urls.length){o.workimgs=[];for(var r=0;r<e.img_urls.length;r++)o.workimgs.push({img:e.img_urls[r],text:e.project.imgText[r]||""})}a({method:"POST",url:ajax_post_publish,data:o}).success(function(o){h=!1,"draft"==t&&n.alertTip("已保存到草稿！",function(){location.href=userHomeUrl+"?go="+e.tab}),n.alertTip("提交成功！",function(){location.href=userHomeUrl+"?go="+e.tab})})}},aid&&g(aid)}]),angular.module("xsj").controller("User",["$scope","$http","$rootScope","$sce","$timeout","$mdDialog","tool",function(e,t,o,n,a,r,i){function c(n){var a={uid:uid};n&&(a.is_region=1),t({method:"GET",url:getProfile,params:a}).success(function(t){if("error"==t.status)return void o.alertTip(t.msg);var n=t.datas;e.project.nickname=n.nickname,e.nicknameTemp=angular.copy(n.nickname),e.project.website=n.website,e.project.bio=n.brief,e.favicon=n.favicon,e.sex=n.sex,e.occupation=n.position,e.schooled=n.school,n.school&&l(n.school),n.direction&&(e.directModel=n.direction),e.provinces=t.provinces,e.provinceModel=n.province_id,e.citys=t.citys,e.cityModel=n.city_id||"",e.sexText=[0,"帅哥","美女"],e.occupationText=[0,"学生","已工作","自由职业"],e.cityText=function(t,o){for(var n=0;n<e[t].length;n++)if(e[t][n].region_id==o)return e[t][n].region_name}})}function s(n){var a={};n&&(a.region_id=n),t({method:"GET",url:getCitys,params:a}).success(function(t){return"error"==t.status?void o.alertTip(t.msg):(e.citys=t.datas,void(e.cityModel=e.citys[0].region_id))})}function l(t){function o(t){return e.schooled=t.name,angular.isObject(t)?t:t}function n(e){var t=e?y.vegetables.filter(a(e)):[];return t}function a(e){var t=e;return function(e){return 0===e._lowername.indexOf(t)}}function r(){for(var e=[],t=0;t<proSchool.length;t++)e.push({name:proSchool[t]});return e.map(function(e){return e._lowername=e.name,e})}b=!0,y.readonly=!1,y.selectedItem=null,y.searchText=null,y.querySearch=n,y.vegetables=r(),y.selectedVegetables=[],t&&(y.selectedVegetables=[{name:t}]),y.numberChips=[],y.numberChips2=[],y.numberBuffer="",y.autocompleteDemoRequireMatch=!0,y.transformChip=o,y.readonly=!1}function u(o,n,a){var r={u:uid,type:o,p:n};t({method:"GET",url:ajax_user_collect_list,params:r}).success(function(t){return t.data&&0!=t.data.length?(e.nodata[e.tab]=!1,t.data.length<10&&(e.nomore[e.tab]=!0),e.List[e.tab]=t.data,console.log(e.List[e.tab]),e.List[e.tab].length==t.count&&(e.nomore[e.tab]=!0),void a(t)):void(e.nodata[e.tab]=!0)})}function p(o,n,a){var r={u:uid,p:n};o&&(r.v=o),a&&(r.type=a),t({method:"GET",url:ajax_user_article_list,params:r}).success(function(t){return t.data&&0!=t.data.length?(e.nodata[e.tab]=!1,t.data.length<10&&(e.nomore[e.tab]=!0),e.List[e.tab]=t.data,e.List[e.tab].length==t.count&&(e.nomore[e.tab]=!0),e.mySendNum=t.count,void d(t,e.tab,r.p)):void(e.nodata[e.tab]=!0)})}function d(t,o,n){e.count[o]=Math.ceil(t.count/16),e.page[o]=n,e.prev[o]=1!=e.page[o],e.next[o]=e.count[o]!=e.page[o],e.counts[o]=[];for(var a=1;a<=e.count[o];a++)e.counts[o].push({mypage:a})}function m(t){e.pImg=t}function g(t){e.favicon=t,m(t)}e.List={},e.nodata={},e.nomore={},e.count={},e.counts={},e.page={},e.prev={},e.next={},e.tab="fir",e.publishPage=publishPage,e.directs=["平面设计师","插画师(绘画)","多媒体设计师","网页设计师","交互设计师","三维动画设计师","产品经理","展览设计师","产品设计师","建筑设计师","室内设计师","景观设计师","家居用品设计师","家具设计师","工艺品设计师","珠宝设计师","服装设计师","玩具设计师","手工DIW制作师","摄影师","设计爱好者","其他"];var f=document.createElement("script");f.src="http://cdn.xiusheji.com/js/school.js";var h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(f,h),a(function(){c(1)},1e3);var v=!0;e.edit=function(){e.editing=!e.editing,e.editing&&v&&(v=!1)};var b=!1;e.occupationChange=function(){b||l(e.schooled)};var y=this;e.$watch("schooled",function(e){""!=e?y.readonly=!0:y.readonly=!1}),e.delSchooled=function(){e.schooled=""},e.project={},e.projectForm={},e.showFail=function(e,t){var o=r.confirm().title("未通过审核原因").textContent(e.cause).ariaLabel("").targetEvent(t).ok("去修改").cancel("取消");r.show(o).then(function(){location.href="/Member/Article/publish/aid/"+e.aid+".html"})},e.saveUser=function(){var n={uid:uid,favicon:e.favicon,sex:"0"==e.sex?"":e.sex,position:"0"==e.occupation?"":e.occupation,school:e.schooled,direction:e.directModel,province_id:e.provinceModel,city_id:e.cityModel};e.nicknameTemp!=e.project.nickname&&(n.nickname=e.project.nickname),n.website=e.project.website,n.brief=e.project.bio,t({method:"POST",url:postProfile,data:n}).success(function(t){return"error"==t.status?(o.alertTip(t.msg),void("nickname"==t.errorname&&(e.nameerrorFun={},e.nameerrorFun.nameerror=!0,e.nameerrorCss={"margin-top":"0px",opacity:1}))):(o.alertTip("已保存"),void e.edit())})},e.provinceChange=function(){s(e.provinceModel)},e.cityChange=function(){console.log(e.cityModel)},e.deleteFun=function(n,a,i){var c=r.confirm().title("提示").textContent("确定删除？").ariaLabel("").targetEvent(i).ok("确定").cancel("取消");r.show(c).then(function(){t({method:"POST",url:ajax_delete_article,data:{aid:n}}).success(function(t){return"error"==t.status?void o.alertTip(t.msg):(o.alertTip(t.msg),void e.List.fir.splice(a,1))})})},e.tabFun=function(t){if(e.tab=t,"four"==e.tab){if(e.List[e.tab]&&e.List[e.tab].length)return;p(0,1,3)}if("sec"==e.tab){if(e.List[e.tab]&&e.List[e.tab].length)return;u(2,1,function(t){d(t.data,e.tab,1)})}else if("thi"==e.tab){if(e.List[e.tab]&&e.List[e.tab].length)return;u(1,1,function(t){d(t.data,e.tab,1)})}},"article"==i.getQuery("from")?e.tabFun("four"):p(0,1,2),e.nextPage=function(t,o){t!=o&&("prev"==t?t=e.page[e.tab]-1:"next"==t&&(t=e.page[e.tab]+1),e.List[e.tab]=[],"fir"==e.tab&&p(0,t,2),"four"==e.tab&&p(0,t,3),"sec"==e.tab&&u(2,t,function(o){d(o.data,e.tab,t)}),"thi"==e.tab&&u(1,t,function(o){d(o.data,e.tab,t)}))},e.previewFun=function(t){if("1"==t.verifystate){if(t.body)e.html=n.trustAsHtml(t.body);else{if("work"!=t.remark)return;var a="";if(!t.workimg||!t.workimg.length)return;for(var r=0;r<t.workimg.length;r++)a+='<div class="img-wrap"><img src="'+t.workimg[r].img+'" alt=""></div><p>'+t.workimg[r].text+"</p>";e.html=angular.copy(a)}return e.project.title=t.title,e.project.title?""==e.html?void o.alertTip("您的主要内容还没填呢！"):void(o.preview=!0):void o.alertTip("您还没有填写标题！")}},o.closePreview=function(){o.preview=!1},e.delCollect=function(n,a,i){if(!uid)return void o.alertTip("请先登录！");var c=r.confirm().title("提示").textContent("确定移出收藏？").ariaLabel("").targetEvent(i).ok("确定").cancel("取消");r.show(c).then(function(){t({method:"POST",url:ajax_cancel_collect,params:{aid:n,type:2}}).success(function(t){return"error"==t.status?void o.alertTip(t.msg):(o.alertTip("已移除"),void e.List.sec.splice(a,1))})})},e.fileUpload={url:"http://oss.aliyuncs.com",callback:{postInit:function(){angular.element(document.getElementById("z0")).css("z-index","0")},filesAdded:function(t,o){plupload.each(o,function(t){previewImage(t,function(t){e.pImgOver=!1,e.progress=1,m(t)})}),set_upload_param(t,o,!1)},beforeUpload:function(e,t){set_upload_param(e,t,!0)},uploadProgress:function(t,o){a(function(){o.percent<100&&(e.progress=o.percent)})},fileUploaded:function(t,o,n){a(function(){e.progress=100}),console.log(alreadyName[o.id]),g("https://img.xiusheji.com/"+alreadyName[o.id]),e.pImgOver=!0},error:function(e,t){a(function(){}),alert("图片太大，最高6M")}}}}]),angular.module("xsj").controller("Topic",["$scope","$http","$rootScope","$timeout","tool","$sce",function(e,t,o,n,a,r){function i(){t({method:"GET",url:getTeventsUrl,params:{aid:aid}}).success(function(t){e.relateList=t.datas})}e.bannerHeight=0,e.active="home",e.relateList=[],e.submitworkurl=submitworkurl,e.submiturl=submiturl,e.display=function(t){e.active=t,"relate"==t&&0==e.relateList.length&&i()},e.upBtn=function(){e.display("emailwork")},e.statusTime=function(e,t){var o=new Date,n="已结束";return o<e?n=0==parseInt((e-o)/864e5)?"<b>即将开始</b>":"还有<b>"+parseInt((e-o)/864e5)+"</b>天开始":o<t&&(n=0==parseInt((t-o)/864e5)?"<b>即将结束</b>":"进行中<br/>还有<b>"+parseInt((t-o)/864e5)+"</b>天结束"),r.trustAsHtml(n)}}]);var accessid="",accesskey="",host="",policyBase64="",signature="",callbackbody="",filename="",key="",expire=0,g_object_name="",timestamp=0,upImg="",now=timestamp=Date.parse(new Date)/1e3,alreadyName=[];